<%- include('../includes/head.ejs') %>

<h2>Dashboard Overview</h2>

<div class="stats-grid">
  <div class="stat-card">
    <h3>Total Notifications</h3>
    <div class="number"><%= stats.total %></div>
  </div>
  <div class="stat-card delivered">
    <h3>Delivered</h3>
    <div class="number"><%= stats.delivered %></div>
  </div>
  <div class="stat-card failed">
    <h3>Failed</h3>
    <div class="number"><%= stats.failed %></div>
  </div>
  <div class="stat-card pending">
    <h3>Pending</h3>
    <div class="number"><%= stats.pending %></div>
  </div>
</div>

<div class="filter-bar">
  <form method="GET" action="/" class="filter-form">
    <div class="filter-field flex-grow">
      <label for="search">Search</label>
      <input 
        type="text" 
        id="search" 
        name="search" 
        value="<%= search %>"
        placeholder="Search by recipient, subject, or content..."
      >
    </div>
    
    <div class="filter-field">
      <label for="status">Status</label>
      <select name="status" id="status">
        <option value="">All</option>
        <option value="pending" <%= filterStatus === 'pending' ? 'selected' : '' %>>Pending</option>
        <option value="delivered" <%= filterStatus === 'delivered' ? 'selected' : '' %>>Delivered</option>
        <option value="failed" <%= filterStatus === 'failed' ? 'selected' : '' %>>Failed</option>
      </select>
    </div>
    
    <div class="filter-field">
      <label for="channel">Channel</label>
      <select name="channel" id="channel">
        <option value="">All</option>
        <option value="email" <%= filterChannel === 'email' ? 'selected' : '' %>>Email</option>
        <option value="sms" <%= filterChannel === 'sms' ? 'selected' : '' %>>SMS</option>
        <option value="webhook" <%= filterChannel === 'webhook' ? 'selected' : '' %>>Webhook</option>
        <option value="push" <%= filterChannel === 'push' ? 'selected' : '' %>>Push</option>
      </select>
    </div>
    
    <button type="submit" class="btn btn-primary">Filter</button>
    <a href="/" class="btn btn-secondary">Clear</a>
  </form>
</div>

<div class="action-bar">
  <a href="/export?format=csv" class="btn-export">ðŸ“¥ Export CSV</a>
</div>

<h3>Recent Notifications</h3>
<table>
  <thead>
    <tr>
      <th>Recipient</th>
      <th>Channel</th>
      <th>Subject</th>
      <th>Status</th>
      <th>Created</th>
      <th>Details</th>
    </tr>
  </thead>
  <tbody>
    <% if (notifications && notifications.length > 0) { %> <%
    notifications.forEach(notification => { %>
    <tr>
      <td><%= notification.recipient %></td>
      <td><%= notification.channel %></td>
      <td><%= notification.subject || '-' %></td>
      <td>
        <span class="status <%= notification.status %>">
          <%= notification.status %>
        </span>
      </td>
      <td><%= new Date(notification.created_at).toLocaleString() %></td>
      <td>
        <a href="/notification/<%= notification.id %>"
          ><%= notification.recipient %></a
        >
      </td>
    </tr>
    <% }) %> <% } else { %>
    <tr>
      <td colspan="5" class="empty-state">
        No notifications yet. <a href="/send">Send your first notification</a>
      </td>
    </tr>
    <% } %>
  </tbody>
</table>

<%- include('../includes/end.ejs') %>
